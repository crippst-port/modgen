/*! aiplacement_modgen - v1.0.0 - 2025-11-18
 * @license GPL-3.0-or-later or later
 */
define(["exports","core/reactive","core/event_dispatcher","aiplacement_modgen/modal","core/notification","core/modal_events"],function(e,t,a,d,o,s){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.init=void 0,d=n(d),o=n(o),s=n(s);let i={stateChanged:"aiplacement_modgen/statechanged"};let l=new t.Reactive({name:"ModalGenerator",eventName:i.stateChanged,eventDispatch:(e,t)=>(0,a.dispatchEvent)(i.stateChanged,e,t),state:{modal:{isOpen:!1,isLoading:!1},form:{isValid:!1,isDirty:!1,isSubmitting:!1}},mutations:new class{openModal(e){e.setReadOnly(!1),e.state.modal.isOpen=!0,e.state.modal.isLoading=!0,e.setReadOnly(!0)}closeModal(e){e.setReadOnly(!1),e.state.modal.isOpen=!1,e.state.modal.isLoading=!1,e.setReadOnly(!0)}formLoaded(e){e.setReadOnly(!1),e.state.modal.isLoading=!1,e.setReadOnly(!0)}}});class c extends t.BaseComponent{create(e){this.courseid=e.courseid,this.contextid=e.contextid,this.modal=null}stateReady(){}getWatchers(){return[{watch:"modal.isOpen:updated",handler:this.handleModalStateChange},{watch:"modal.isLoading:updated",handler:this.handleLoadingChange}]}handleModalStateChange(e){e=e.state;e.modal.isOpen&&!this.modal?this.createModal():!e.modal.isOpen&&this.modal?(this.modal.destroy(),this.modal=null):e.modal.isOpen&&this.modal&&this.modal.show()}handleLoadingChange(e){e=e.state;this.modal&&e.modal.isLoading&&this.modal.setBody('<div class="spinner-border" role="status"><span class="sr-only">Loading...</span></div>')}createModal(){var e=M.cfg.wwwroot+"/ai/placement/modgen/prompt.php?id="+this.courseid;d.default.create({title:"Module Generator",body:'<div class="text-center p-4"><p>Click the button below to open the Module Generator form.</p><a href="'+e+'" class="btn btn-primary btn-lg">Open Module Generator</a></div>',large:!1}).then(e=>(this.modal=e,this.modal.getRoot().on(s.default.hidden,()=>{this.reactive.dispatch("closeModal")}),this.modal.show(),e)).catch(o.default.exception)}open(){this.reactive.dispatch("openModal")}close(){this.reactive.dispatch("closeModal")}}e.init=(e,t)=>new c({element:document.body,reactive:l,courseid:e,contextid:t})});